# PGSD-039: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–å¤±æ•—ã‚¨ãƒ©ãƒ¼ä¿®æ­£

## ğŸ“‹ åŸºæœ¬æƒ…å ±

- **ãƒã‚±ãƒƒãƒˆç•ªå·**: PGSD-039
- **ã‚¿ã‚¤ãƒˆãƒ«**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–å¤±æ•—ã‚¨ãƒ©ãƒ¼ä¿®æ­£
- **ç¨®åˆ¥**: ãƒã‚°ä¿®æ­£ (Bug Fix)
- **å„ªå…ˆåº¦**: High
- **ä½œæˆæ—¥**: 2025-07-18
- **æ‹…å½“è€…**: ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒãƒ¼ãƒ 
- **æ¨å®šå·¥æ•°**: 3æ™‚é–“
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: TODO

## ğŸ› ãƒã‚°è©³ç´°

### ç¾è±¡
ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’ç›´æ¥æŒ‡å®šã—ã¦pgsdã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–ã«å¤±æ•—ã™ã‚‹ã€‚

### å†ç¾æ‰‹é †
1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ:
   ```bash
   pgsd compare \
     --source-host localhost \
     --source-db ntb \
     --source-user ntb \
     --source-password ntb \
     --source-schema ntb \
     --target-host localhost \
     --target-db ntb_demo3 \
     --target-user ntb_demo3 \
     --target-password ntb_demo3 \
     --target-schema ntb_demo3 \
     --format html \
     --output reports/
   ```

### å®Ÿéš›ã®çµæœ
```
Analyzing schemas: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]   30.0% (0.0s)
ERROR:pgsd.database.manager:Failed to initialize database manager
ERROR:pgsd.core.engine:Failed to initialize schema comparison engine: Database manager initialization failed: Source database verification failed: Database manager not initialized
ERROR:pgsd.cli.commands.CompareCommand:Schema comparison failed: Engine initialization failed: Database manager initialization failed: Source database verification failed: Database manager not initialized
```

### æœŸå¾…ã•ã‚Œã‚‹çµæœ
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã€ã‚¹ã‚­ãƒ¼ãƒæ¯”è¼ƒå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚

### æ¤œè¨¼æ¸ˆã¿äº‹é …
- PostgreSQLã‚µãƒ¼ãƒãƒ¼ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ï¼ˆ`pg_isready -h localhost -p 5432` = OKï¼‰
- ç›´æ¥çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã¯æ­£å¸¸ï¼ˆ`psql`ã§ä¸¡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šå¯èƒ½ï¼‰
- æ¥ç¶šæƒ…å ±ã¯æ­£ã—ãæŒ‡å®šã•ã‚Œã¦ã„ã‚‹

## ğŸ¯ åŸå› åˆ†æ

### ç–‘ã‚ã‚Œã‚‹åŸå› 
1. **éåŒæœŸå‡¦ç†ã®å•é¡Œ**: `DatabaseManager.initialize()`ãŒasyncãƒ¡ã‚½ãƒƒãƒ‰ã ãŒã€é©åˆ‡ã«awaitã•ã‚Œã¦ã„ãªã„
2. **åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–æ™‚ã«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¦ã„ãªã„
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åˆæœŸåŒ–å¤±æ•—æ™‚ã®ä¾‹å¤–å‡¦ç†ãŒä¸é©åˆ‡
4. **è¨­å®šå€¤ã®ä¼æ’­**: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‹ã‚‰è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å¤‰æ›ã«å•é¡Œ

### ç¢ºèªãŒå¿…è¦ãªç®‡æ‰€
- `src/pgsd/core/engine.py`: ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–å‡¦ç†
- `src/pgsd/database/manager.py`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–
- `src/pgsd/cli/commands.py`: compareã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
- `src/pgsd/config/manager.py`: è¨­å®šå€¤ã®æ§‹ç¯‰

## ğŸ”§ ä¿®æ­£æ–¹é‡

### 1. éåŒæœŸå‡¦ç†ã®ä¿®æ­£
- ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–æ™‚ã®awaitå‡¦ç†ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–ã®åŒæœŸåŒ–
- é©åˆ‡ãªéåŒæœŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†

### 2. åˆæœŸåŒ–é †åºã®è¦‹ç›´ã—
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ â†’ ã‚¨ãƒ³ã‚¸ãƒ³ ã®é †åºä¿è¨¼
- åˆæœŸåŒ–çŠ¶æ…‹ã®é©åˆ‡ãªç®¡ç†
- ä¾å­˜é–¢ä¿‚ã®æ˜ç¢ºåŒ–

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½åŠ 
- åˆæœŸåŒ–å¤±æ•—åŸå› ã®ç‰¹å®šæ©Ÿèƒ½
- ãƒ­ã‚°å‡ºåŠ›ã®æ”¹å–„

### 4. è¨­å®šå€¤æ¤œè¨¼
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®æ­£ã—ã„è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ›
- å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®é©ç”¨

## ğŸ“ ä¿®æ­£ã‚¿ã‚¹ã‚¯

### é«˜å„ªå…ˆåº¦
- [ ] core/engine.py ã®åˆæœŸåŒ–å‡¦ç†èª¿æŸ»
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®éåŒæœŸå‡¦ç†ç¢ºèª
- [ ] ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‹ã‚‰è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å¤‰æ›ç¢ºèª
- [ ] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãƒ­ã‚°å‡ºåŠ›

### ä¸­å„ªå…ˆåº¦
- [ ] åˆæœŸåŒ–é †åºã®æœ€é©åŒ–
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆã®å¼·åŒ–

### ä½å„ªå…ˆåº¦
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- [ ] ä½¿ç”¨ä¾‹ã®è¿½åŠ 

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 1. æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã§ã®æ­£å¸¸å‹•ä½œç¢ºèª
- ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã§ã®å‹•ä½œç¢ºèª
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã§ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª

### 2. éåŒæœŸå‡¦ç†ãƒ†ã‚¹ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–ã®åŒæœŸãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
- ä¸¦è¡Œå‡¦ç†ã§ã®å‹•ä½œç¢ºèª

### 3. ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- ç„¡åŠ¹ãªæ¥ç¶šæƒ…å ±ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼åœæ­¢æ™‚ã®å‹•ä½œ
- æ¨©é™ä¸è¶³ã§ã®å‹•ä½œ

## ğŸ¯ å—å…¥æ¡ä»¶

1. **åŸºæœ¬å‹•ä½œ**
   - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã§ã®pgsdã‚³ãƒãƒ³ãƒ‰ãŒæ­£å¸¸å®Ÿè¡Œã•ã‚Œã‚‹
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã‚‹
   - ã‚¹ã‚­ãƒ¼ãƒæ¯”è¼ƒå‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - åˆæœŸåŒ–å¤±æ•—æ™‚ã«è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - å•é¡Œã®ç‰¹å®šãŒå®¹æ˜“ã«ãªã‚‹
   - é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›ãŒã•ã‚Œã‚‹

3. **å›å¸°é˜²æ­¢**
   - æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ã‚’ä¸ãˆãªã„
   - å˜ä½“ãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼ã•ã‚Œã‚‹
   - CI/CDã§è‡ªå‹•æ¤œè¨¼ã•ã‚Œã‚‹

## ğŸ“š é–¢é€£æƒ…å ±

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/pgsd/core/engine.py`: ã‚¹ã‚­ãƒ¼ãƒæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³
- `src/pgsd/database/manager.py`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
- `src/pgsd/cli/commands.py`: CLIã‚³ãƒãƒ³ãƒ‰å‡¦ç†
- `src/pgsd/config/manager.py`: è¨­å®šç®¡ç†

### é–¢é€£ãƒã‚±ãƒƒãƒˆ
- PGSD-038: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨æ™‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼ˆåˆ¥ä»¶ï¼‰
- PGSD-025: CLIå®Ÿè£…ï¼ˆå®Œäº†ï¼‰
- PGSD-015: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç®¡ç†å®Ÿè£…ï¼ˆå®Œäº†ï¼‰

### æŠ€è¡“çš„è©³ç´°
```python
# DatabaseManager.initialize() ã¯éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰
async def initialize(self) -> None:
    # åˆæœŸåŒ–å‡¦ç†

# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æµã‚Œ
# 1. "Database manager not initialized" 
# 2. "Source database verification failed"
# 3. "Database manager initialization failed"
```

## ğŸ“ ä½œæ¥­è¨˜éŒ²

- **é–‹å§‹æ—¥æ™‚**: 2025-07-18
- **å®Œäº†æ—¥æ™‚**: æœªå®Œäº†
- **å®Ÿç¸¾æ™‚é–“**: æœªè¨˜éŒ²
- **è¦‹ç©ã¨ã®å·®ç•°**: æœªè¨˜éŒ²

---
**ãƒã‚±ãƒƒãƒˆä½œæˆè€…**: Claude Assistant  
**æœ€çµ‚æ›´æ–°**: 2025-07-18